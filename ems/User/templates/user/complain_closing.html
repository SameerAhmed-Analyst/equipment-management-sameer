{% extends "user/home.html" %}

{% load static %}

{% block head %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://kit.fontawesome.com/a06ab02596.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'user/css/custom.css' %}">
    <link rel="stylesheet" href="{% static 'maintenance/css/custom-complain.css' %}">
    <link rel="stylesheet" href="{% static 'User/spares.css' %}">
    <link rel="stylesheet" href="{% static 'User/complain_closing.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% endblock head %}


{% block title %}
  Complain Closing
{% endblock title %}
{% block main-body %}
<div class="form-container">
    <form action="{% url 'User:complain_closing' pk=issue.pk %}" method="post" enctype="multipart/form-data">
        
        {% csrf_token %}
        
        <div class="three-row">
            <label for="date">Date</label>
            <input type="text" class="set-date form-content" id="date" name="date" value="" disabled>
    
            <label for="complain#">Complain#</label>
            <input type="text" class="complain-number" id="complain" name="complain" value="{{ issue.ticket_num }}" disabled>
    
            <label for="generated_by">Generated by</label>
            <input type="text" value="" id="generated_by" class="form-content" name="generated_by" value="{{ issue.user.name }}" disabled>
        </div>

        <div class="machine-hours dual-row">

            <label for="initial-machine-hours">Machine Hours At Failure</label>
            <input type="number" class="machine-hours form-content" name="initial-machine-hours" id="initial-machine-hours" value="{{ issue.machine_hours }}" disabled>

            <label for="final-machine-hours">Machine Hours After Failure</label>
            <input type="number" class="machine-hours form-content" id="final-machine-hours" name="machine-hours">
        
        </div>

        <div class="single-row">
            <label for="spares">Spares Installed</label>
                {% if not issue.machineissuereview.malfunction_part.all %}
                <div  id="spares" contenteditable="false">
                    None
                </div>
                {% else %}
                <div  id="spares" contenteditable="false">
                    {% for spare in issue.machineissuereview.malfunction_part.all %}
                        {{spare}} || 
                    {% endfor %}
                </div>                
                {% endif %}
            </ul>
        </div>

        <div class="three-row">

            <select onchange="changeOptions()" name="resolved by" id="resolvedby">
                    <option value="In House" selected>Inhouse</option>
                    <option value="OutSource">Outsource</option>  
            </select>
            
            <label id="resolvedLabel" for="resolved by">Service Provider</label>
            <select   name="resolved by" id="resolvedByinhouse" {% if issue.machineissuereview.assignDepartment.name %} disabled="true" {% endif %}>

                <option value="" selected>{{issue.machineissuereview.assignDepartment.name}}</option>

                {% for contractor in contractors  %}
                    <option value="{{contractor.id}}">{{contractor.contractor}}</option>  
                {% endfor %}    
            
            </select>
            <select  name="resolvedby" id="resolvedByOutsource">            
                {% for contractor in contractors  %}
                    <option value="{{contractor.id}}">{{contractor.contractor}}</option>  
                {% endfor %}    
            </select>
            

            <label for="technician">Technician name</label>
            <input type="text" class="machine-hours form-content" id="technician" name="technician">
        </div>
        
        <div class="single-row">
            <label for="supervisor">Supervior</label>
            <input type="text" class="machine-hours form-content" id="supervisor" name="supervisor">
        
        <div class="single-row">
            <label for="solution-description">Solution Description</label>
            <textarea name="solution-description" id="solution-description" class="form-content" cols="12" rows="5"></textarea>

        </div>
        
        <div class="dual-row">
            <label for="equipment-status">Equipment Status</label>
            <select class="selectors form-content" name="equipment-status" id="equipment-status">
                <option value="on">on</option>
                <option value="off">off</option>
            </select>
            
            
            <label for="duration">Duration</label>
            <input type="number" class="machine-hours form-content" id="duration" name="duration">

        </div>
        
        <label for="additional-remarks">Additional Remarks</label>
        <textarea name="additional-remarks" id="additional-remarks" class="form-content" cols="12" rows="5"></textarea>

        
        <label for="images">Upload Alarm history</label>
        <input type="file" id="image" class="form-content" name="image[]">

        <div class="submission">
            <input type="submit" class="button btn-primary" name="temp-close" id="temp-close" value="Temprory Close">
            <input type="submit" class="button btn-danger" name="close-complain" id="close-complain" value="Close Complaint">
        </div>

        

    </form>
    
</div>

<script>


    // // resolved_by = document.querySelector('#resolvedby')
    window.addEventListener("load",function(e){
        // console.log('I am here')
        selectedValue = document.querySelector("#resolvedby")
        change1 = document.querySelector('#resolvedByinhouse')
        change = document.querySelector('#resolvedByOutsource')
        changeLabel = document.querySelector('#resolvedLabel')
        if (selectedValue.value==='In House'){
            change1.style.display='None'
            change.style.display='block'
            changeLabel.style.display='block'
        }        
    })


    function changeOptions(){
        selectedValue = document.querySelector("#resolvedby")
        change1 = document.querySelector('#resolvedByinhouse')
        change = document.querySelector('#resolvedByOutsource')
        changeLabel = document.querySelector('#resolvedLabel')
        // console.log(selectedValue.value)
      
        if (selectedValue.value === 'In House'){
            change1.style.display = 'block';
            change.style.display = 'None';
            changeLabel.style.display='block';
        }

        else{
            change1.style.display = 'None';
            change.style.display = 'block';
            changeLabel.style.display='block';
        }
    }
    date = document.querySelector("#date")
    const today = new Date();
    const formattedDate = today.toISOString().substring(0, 16); // YYYY-MM-DD format 
    date.value = formattedDate;
</script>

{% endblock main-body %}